<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home</title>

  <link rel="stylesheet" href="css/normalize.css" />
  <link rel="stylesheet" href="css/sweetalert2.css" />
  <link rel="stylesheet" href="css/material.min.css" />
  <link rel="stylesheet" href="css/material-design-iconic-font.min.css" />
  <link rel="stylesheet" href="css/jquery.mCustomScrollbar.css" />
  <link rel="stylesheet" href="css/main.css" />

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/jquery-1.11.2.min.js"><\/script>')</script>
  <script src="js/material.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="js/main.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import {
      getDatabase,
      ref,
      get, 
      onValue
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

      const firebaseConfig = {
  apiKey: "AIzaSyCE9UY3P3oEFZ_cgX7d5Ox0lFZiL_9Uszs",
  authDomain: "accesoriostr-7f01e.firebaseapp.com",
  databaseURL: "https://accesoriostr-7f01e-default-rtdb.firebaseio.com",
  projectId: "accesoriostr-7f01e",
  storageBucket: "accesoriostr-7f01e.firebasestorage.app",
  messagingSenderId: "927871540022",
  appId: "1:927871540022:web:eb4a9a446cc0a6530a7197"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    onAuthStateChanged(auth, (user) => {
      if (user) {
        get(ref(database, 'usuarios/' + user.uid)).then((snapshot) => {
          const data = snapshot.val();
          const rol = data?.rol || "cliente";
          const spanInfo = `${user.email}<br><small>${rol}</small>`;
          document.querySelectorAll(".navLateral-body-cr span").forEach(el => el.innerHTML = spanInfo);
        });
      } else {
        window.location.href = "index.html";
      }
    });

    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      });
    };
    function contarRama(ruta, idElemento, filtroFn = null) {
  onValue(ref(database, ruta), snapshot => {
    const datos = snapshot.val() || {};
    let total = Object.keys(datos).length;
    if (filtroFn) {
      total = Object.values(datos).filter(filtroFn).length;
    }
    document.getElementById(idElemento).innerHTML = `${total}<br><small>${document.getElementById(idElemento).innerText.split('\n')[1]}</small>`;
  });
}

contarRama("usuarios", "totalAdmins", u => u.rol === "admin");
contarRama("clientes", "totalClientes");
contarRama("proveedores", "totalProveedores");
contarRama("productos", "totalProductos");
contarRama("ventas", "totalVentas");
  </script>
</head>

<body>
  <!-- Navbar -->
  <div class="full-width navBar">
    <div class="full-width navBar-options">
      <i class="zmdi zmdi-more-vert btn-menu" id="btn-menu"></i>
      <div class="mdl-tooltip" for="btn-menu">Menú</div>
      <nav class="navBar-options-list">
        <ul class="list-unstyle">
          <li class="btn-exit" onclick="logout()">
            <i class="zmdi zmdi-power"></i>
            <div class="mdl-tooltip" for="btn-exit">Cerrar sesión</div>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Barra lateral -->
  <section class="full-width navLateral">
    <div class="full-width navLateral-bg btn-menu"></div>
    <div class="full-width navLateral-body">
      <div class="full-width navLateral-body-logo text-center tittles">
        <i class="zmdi zmdi-close btn-menu"></i>TR ACCESORIOS
      </div>
      <figure class="full-width" style="height: 77px;">
        <div class="navLateral-body-cl">
          <img src="assets/img/logo.jpg" alt="Avatar" class="img-responsive" />
        </div>
        <figcaption class="navLateral-body-cr hide-on-tablet">
          <span>
            Usuario<br />
            <small>Rol</small>
          </span>
        </figcaption>
      </figure>
      <div class="full-width tittles navLateral-body-tittle-menu">
        <i class="zmdi zmdi-desktop-mac"></i><span class="hide-on-tablet"> MENÚ</span>
      </div>
      <nav class="full-width">
        <ul class="full-width list-unstyle menu-principal">
          <li><a href="home.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-view-dashboard"></i></div><div class="navLateral-body-cr hide-on-tablet">Inicio</div></a></li>
          <li><a href="inventory.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-store"></i></div><div class="navLateral-body-cr hide-on-tablet">Inventario</div></a></li>
          <li><a href="client.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-accounts"></i></div><div class="navLateral-body-cr hide-on-tablet">Clientes</div></a></li>
          <li><a href="sales.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-shopping-basket"></i></div><div class="navLateral-body-cr hide-on-tablet">Compras</div></a></li>
          <li><a href="providers.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-truck"></i></div><div class="navLateral-body-cr hide-on-tablet">Proveedores</div></a></li>
          <li><a href="ventas.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-shopping-cart"></i></div><div class="navLateral-body-cr hide-on-tablet">Ventas</div></a></li>
          <li><a href="cuentas-cobrar.html" class="full-width"><div class="navLateral-body-cl"><i class="zmdi zmdi-balance-wallet"></i></div><div class="navLateral-body-cr hide-on-tablet">Cuentas por cobrar</div></a></li>
          </ul>
      </nav>
    </div>
  </section>

  <!-- Contenido -->
  <section class="full-width pageContent">
    <section class="full-width text-center" style="padding: 40px 0;">
      <h3 class="text-center tittles">Panel de administración</h3>

      <!-- Mosaicos -->
      <article class="full-width tile" onclick="location.href='admin.html'" style="cursor:pointer;">
  <div class="tile-text">
    <span class="text-condensedLight" id="totalAdmins">0<br><small>Administradores</small></span>
  </div>
  <i class="zmdi zmdi-account tile-icon"></i>
</article>

<article class="full-width tile" onclick="location.href='client.html'" style="cursor:pointer;">
  <div class="tile-text">
    <span class="text-condensedLight" id="totalClientes">0<br><small>Clientes</small></span>
  </div>
  <i class="zmdi zmdi-accounts tile-icon"></i>
</article>

<article class="full-width tile" onclick="location.href='providers.html'" style="cursor:pointer;">
  <div class="tile-text">
    <span class="text-condensedLight" id="totalProveedores">0<br><small>Proveedores</small></span>
  </div>
  <i class="zmdi zmdi-truck tile-icon"></i>
</article>

<article class="full-width tile" onclick="location.href='inventory.html'" style="cursor:pointer;">
  <div class="tile-text">
    <span class="text-condensedLight" id="totalProductos">0<br><small>Productos</small></span>
  </div>
  <i class="zmdi zmdi-washing-machine tile-icon"></i>
</article>

<article class="full-width tile" onclick="location.href='ventas.html'" style="cursor:pointer;">
  <div class="tile-text">
    <span class="text-condensedLight" id="totalVentas">0<br><small>Ventas</small></span>
  </div>
  <i class="zmdi zmdi-shopping-cart tile-icon"></i>
</article>
    </section>
  </section>
</body>
</html>